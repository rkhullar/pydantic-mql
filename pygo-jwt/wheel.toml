[tool.cibuildwheel]
environment = {GO_VERSION="1.21.8", ASDF_VERSION="0.14.0"}
skip = ["*-musllinux*"]

[tool.cibuildwheel.linux]
before-all = [
    "yum install -y make"
]
before-build = [
    "uname -a",
    "pip install pygo-tools",
    "./scripts/install-asdf-go.sh"
]
repair-wheel-command = "auditwheel repair --lib-sdir lib -w {dest_dir} {wheel}"

[[tool.cibuildwheel.overrides]]
select="*-????linux_*"
inherit.environment="append"
environment.ASDF_DIR = "/opt/asdf"

[[tool.cibuildwheel.overrides]]
select = "*-musllinux*"
before-all = [
    "apk add make",
]

[tool.cibuildwheel.macos]
before-build = [
    "uname -a",
    "pip install pygo-tools",
]
repair-wheel-command = [
    "python scripts/patch-macos-wheel.py --wheel {wheel} --dest-dir {dest_dir}",
    "cp {wheel} {dest_dir}"
    #"delocate-wheel --require-archs {delocate_archs} -w {dest_dir} -v {wheel}"
]
